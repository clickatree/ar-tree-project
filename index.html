<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Personalized Video</title>
  <style>
    body, html {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
      overflow: hidden;
      display: flex;
      align-items: center;
      justify-content: center;
      background: black;
    }
    #video-container {
      position: relative;
      width: 100%;
      max-width: 800px;
    }
    video, canvas {
      width: 100%;
      height: auto;
    }
    canvas {
      position: absolute;
      top: 0;
      left: 0;
      pointer-events: none; /* Mausereignisse ignorieren */
    }
  </style>
</head>
<body>
  <div id="video-container">
    <video id="personalized-video" controls>
      <source src="https://raw.githubusercontent.com/melsen123/ar-tree-project/main/video3.mp4" type="video/mp4">
      Your browser does not support the video tag.
    </video>
    <canvas id="text-overlay"></canvas>
  </div>

  <script>
    const video = document.getElementById('personalized-video');
    const canvas = document.getElementById('text-overlay');
    const ctx = canvas.getContext('2d');

    // Originalgröße des Videos in Mocha
    const originalWidth = 1920; // Beispielwert, anpassen
    const originalHeight = 1080; // Beispielwert, anpassen

    // Funktion zum Laden der JSON-Daten
    fetch('https://raw.githubusercontent.com/melsen123/ar-tree-project/main/test3.json')
      .then(response => response.json())
      .then(trackingData => {

        function updateCanvasSize() {
          canvas.width = video.videoWidth;
          canvas.height = video.videoHeight;
        }

        function drawTextOnCanvas(text, x, y, angle) {
          ctx.clearRect(0, 0, canvas.width, canvas.height); // Canvas löschen
          ctx.save();
          ctx.translate(x, y);
          ctx.rotate(angle * Math.PI / 180);
          ctx.fillStyle = 'white';
          ctx.font = '36px Oswald';
          ctx.fillText(text, 0, 0);
          ctx.restore();
        }

        function calculateTextTransform(corners) {
          const scaleX = video.videoWidth / originalWidth;
          const scaleY = video.videoHeight / originalHeight;

          const scaledCorners = corners.map(corner => ({
            x: corner.x * scaleX,
            y: corner.y * scaleY
          }));

          const midTop = {
            x: (scaledCorners[0].x + scaledCorners[1].x) / 2,
            y: (scaledCorners[0].y + scaledCorners[1].y) / 2
          };
          const midBottom = {
            x: (scaledCorners[2].x + scaledCorners[3].x) / 2,
            y: (scaledCorners[2].y + scaledCorners[3].y) / 2
          };

          const angle = Math.atan2(midBottom.y - midTop.y, midBottom.x - midTop.x) * (180 / Math.PI);

          return { x: midTop.x, y: midTop.y, angle };
        }

        video.addEventListener('loadedmetadata', updateCanvasSize);
        window.addEventListener('resize', updateCanvasSize);

        video.addEventListener('timeupdate', () => {
          const currentFrame = Math.floor(video.currentTime * 30); // FPS anpassen auf 30
          const data = trackingData.scene1.frameData.find(frame => frame.frame === currentFrame);
          if (data) {
            const transform = calculateTextTransform(data.corners);
            drawTextOnCanvas("NAME", transform.x, transform.y, transform.angle);
          } else {
            ctx.clearRect(0, 0, canvas.width, canvas.height); // Canvas löschen, wenn kein Text angezeigt wird
          }
        });
      })
      .catch(error => console.error('Error loading tracking data:', error));
  </script>
</body>
</html>








