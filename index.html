<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>AR Tree Project</title>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/aframe-ar@1.0.0/dist/aframe-ar.min.js"></script>
    <script>
      AFRAME.registerComponent('ar-hit-test', {
        init: function () {
          this.hitTestSource = null;
          this.viewerSpace = null;
          this.refSpace = null;
          this.reticle = document.querySelector('#tree-model');
          this.renderer = this.el.sceneEl.renderer;

          const self = this;

          this.el.sceneEl.addEventListener('enter-vr', function () {
            const session = self.el.sceneEl.renderer.xr.getSession();
            session.addEventListener('select', self.onSelect.bind(self));

            session.requestReferenceSpace('viewer').then((space) => {
              self.viewerSpace = space;
              session.requestHitTestSource({ space }).then((source) => {
                self.hitTestSource = source;
              });
            });

            session.requestReferenceSpace('local-floor').then((space) => {
              self.refSpace = space;
            });
          });

          this.el.sceneEl.addEventListener('exit-vr', function () {
            self.hitTestSource = null;
            self.viewerSpace = null;
            self.refSpace = null;
          });
        },

        tick: function () {
          if (!this.hitTestSource) return;

          const frame = this.el.sceneEl.frame;
          const hitTestResults = frame.getHitTestResults(this.hitTestSource);

          if (hitTestResults.length > 0) {
            const referenceSpace = this.refSpace;
            const hitPose = hitTestResults[0].getPose(referenceSpace);

            this.reticle.setAttribute('visible', 'true');
            this.reticle.object3D.position.set(
              hitPose.transform.position.x,
              hitPose.transform.position.y,
              hitPose.transform.position.z
            );
            this.reticle.object3D.rotation.set(
              hitPose.transform.orientation.x,
              hitPose.transform.orientation.y,
              hitPose.transform.orientation.z,
              hitPose.transform.orientation.w
            );
          } else {
            this.reticle.setAttribute('visible', 'false');
          }
        },

        onSelect: function () {
          if (this.reticle.getAttribute('visible')) {
            const clone = this.reticle.cloneNode();
            this.el.sceneEl.appendChild(clone);
          }
        },
      });
    </script>
  </head>
  <body style="margin: 0; overflow: hidden;">
    <a-scene
      vr-mode-ui="enabled: false"
      embedded
      arjs="sourceType: webcam; debugUIEnabled: false;"
      renderer="logarithmicDepthBuffer: true;"
    >
      <!-- Definieren Sie den Boden, um eine FlÃ¤che zu erkennen -->
      <a-plane
        position="0 0 0"
        rotation="-90 0 0"
        width="10"
        height="10"
        color="#FFFFFF"
        material="opacity: 0.5;"
        shadow
      ></a-plane>

      <!-- Definieren Sie das 3D-Modell -->
      <a-entity
        id="tree-model"
        gltf-model="url(Fulltrees.glb)"
        scale="0.5 0.5 0.5"
        visible="false"
        shadow
      ></a-entity>

      <!-- Definieren Sie den AR-Hit-Test-Controller -->
      <a-entity ar-hit-test="target: #tree-model;"></a-entity>

      <!-- Kamera -->
      <a-entity camera></a-entity>
    </a-scene>
  </body>
</html>











